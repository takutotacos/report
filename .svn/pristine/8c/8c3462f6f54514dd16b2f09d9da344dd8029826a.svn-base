class ReportShowController < ApplicationController
    def show
        # 　検索用のフォームを生成する
        @form = ReportShow.new

        # 検索条件に入力されたユーザ名の日報を表示する
        # １．セッションからログインユーザを取得
        @user ||= User.find_by(user_id: session[:user_id])
        # ２．ユーザの所属するグループを取得
        @group = Group.joins(:users).where('users.user_id = ?', @user.user_id).first
        # ３．取得したユーザIDを元に、レポートを取得
        @report = Report.where('group_id = ?', @group.group_id).order(:created_at).reverse_order
        # ４．本日の予定欄に表示する予定は、前日書いた次回予定を表示するため、一日前の予定を取得
        require 'date'
        day = Date.today
        @report.each do |y|
            y.yesterday_plan = Report.where('group_id = ?', @group.group_id).where('created_at > ? ', day).order(:created_at).reverse_order
        end
    end

    def find
        # 　検索用のフォームを生成する
        @form = ReportShow.new

        #  検索条件に入力されたユーザ名の日報を表示する
        # １．入力されたユーザ名を元に、ユーザIDを取得
        user_name = params[:report_show][:user_name]
        @user = User.where('user_name = ?', user_name).first
        # ２．所属グループ名を取得
        @group = Group.joins(:users).where('users.user_id = ?', @user.user_id).first
        # ３．取得したユーザIDを元に、レポートを取得
        @report = Report.where('user_id = ?', @user.user_id).order(:created_at).reverse_order
        # ４．本日の予定欄に表示する予定は、前日書いた次回予定を表示するため、一日前の予定を取得
        require 'date'
        day = Date.today
        @report.each do |y|
            y.yesterday_plan = Report.where('group_id = ?', @group.group_id).where('created_at > ?', day).order(:created_at).reverse_order
        end
      end
end
